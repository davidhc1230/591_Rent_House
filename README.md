# 租屋資訊爬蟲與文字辨識工具

## 📌 概述

此工具結合 Selenium 與 PaddleOCR，能夠自動化爬取租屋網站的房屋資訊，包括標題、地址、城市、區域、聯絡人身份、名稱、電話號碼、房屋類型、坪數、樓層與租金等資料，並對網站上的圖片進行文字辨識以補全相關資訊。

<br>

## 📌 功能

- **租屋資訊爬取**：自動訪問租屋網站，擷取房屋資訊及圖片。
- **圖片文字辨識**：使用 PaddleOCR 對圖片中的文字進行辨識，提取關鍵數據。
- **資料存檔**：將爬取的資訊以 JSON 格式儲存。
- **圖片處理與儲存**：對圖片進行對比度和亮度的增強處理後，保存為本地檔案。
- **錯誤處理與重試**：支持多次嘗試以提高爬取成功率。

<br>

## 📌 運作流程

1. **初始化設定**：
   - 配置 Selenium WebDriver。
   - 初始化 PaddleOCR 用於圖片文字辨識。

2. **URL 讀取與處理**：
   - 從本地檔案 `url.txt` 讀取目標 URL 清單。

3. **爬取資料**：
   - 自動訪問每個 URL，定位關鍵元素，提取文本和圖片資訊。
   - 圖片經處理後進行 OCR 辨識。

4. **圖片儲存與文字辨識**：
   - 將圖片保存至本地，並使用 PaddleOCR 提取文字內容。

5. **資料整合與輸出**：
   - 將所有爬取結果整合成結構化資料，儲存為 JSON 檔案。

<br>

## 📌 程式架構

```bash
project/
├── main.py                  # 主程式，包含爬蟲與文字辨識邏輯
├── url.txt                  # 存放目標網站 URL 清單
├── output.json              # 儲存最終結果的 JSON 檔案
├── area_image_base64/       # 儲存坪數圖片
└── address_image_base64/    # 儲存地址圖片
```

<br>

## 📌 環境設定與執行指令

### 1. 環境設定

- 確保系統安裝了以下套件：
  - Python 3.8+
  - 必要套件：

```bash
pip install selenium webdriver-manager paddleocr Pillow numpy
```

- 安裝 Chrome 瀏覽器與相應的 ChromeDriver。

<br>

### 2. 執行程式

在專案目錄下執行以下指令：

```bash
python main.py
```

執行後，爬取結果將儲存於 `output.json` 檔案。

<br>

## 📌 程式邏輯

### 1. Selenium 初始化

- 設定 WebDriver 參數：
  - 使用 `--headless` 模式，提升執行效率。
  - 加入模擬使用者行為的 `user-agent`。

### 2. PaddleOCR 初始化

- 使用 `use_angle_cls=True` 啟用角度分類，增強對旋轉文字的辨識能力。

### 3. 資料處理邏輯

- **元素定位與爬取**：
  - 定位目標元素並擷取資訊，包括：標題、城市、區域、發文者身份與名稱、電話號碼。
  - 擷取圖片資訊作為 Base64 字串。

- **圖片處理與文字辨識**：
  - 對圖片進行亮度與對比度增強，提升辨識效果。
  - 使用 PaddleOCR 對圖片文字進行解析，提取坪數、樓層與租金資訊。

- **錯誤處理與重試**：
  - 每個 URL 最多嘗試 5 次，若關鍵資訊無法取得，將記錄錯誤。

### 4. 資料輸出

- 最終結果以 JSON 格式保存，結構範例如下：

```json
[
  {
    "title": "清靜套房",
    "address": "台北市大安區復興南路",
    "city": "台北市",
    "district": "大安區",
    "poster_identity": "房東",
    "poster_name": "王先生",
    "phone_number": "0912345678",
    "house_type": "套房",
    "house_type_1": "獨立套房",
    "area": "10坪",
    "floor_height": "3",
    "total_floors": "5",
    "rent": "15000"
  }
]
```

<br>

## 📌 常見問題與錯誤排除

### 1. 無法啟動 WebDriver
- 確認已安裝與 Chrome 瀏覽器版本匹配的 ChromeDriver。
- 檢查是否已安裝 `webdriver-manager` 套件。

### 2. OCR 辨識失敗
- 確保圖片清晰度足夠，並嘗試調整亮度或對比度參數。

### 3. 程式執行過程中斷
- 檢查網頁結構是否更新，必要時更新元素定位的 CSS 選擇器。

<br>

## 📌 版本資訊

### v1.0
- 實現基本的租屋資訊爬取功能。
- 支援圖片處理與文字辨識。
- 輸出結構化 JSON 資料。

### 未來改進方向
- 支援多語言 OCR 辨識。
- 增加更多容錯與自動適應功能。
- 優化執行效能，縮短爬取時間。

